webpackJsonp([43],{"/kWS":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});i("lMgl"),i("D9hl"),i("3ntp");var l=i("aiqZ"),s=i("crgx"),a=i.n(s),o={data:function(){return{pageTypeList:[],postObj:{url:"",title:"",content:"",pageType:1},rules:{pageType:[{required:!0,message:"请输入用户账户",trigger:"change"}],title:[{required:!0,message:"请输入用标题",trigger:"blur"},{min:1,max:100,message:"长度在 1 到 100 个字符",trigger:"blur"}]},disabled:!1,originUrl:"",uploadData:{},photoUrl:"",uploadType:"",serverPath:"",fullscreenLoading:!1}},methods:{save:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;var i="/cloud/backmgr/page/createPageInfo";e.postObj.id&&(i="/cloud/backmgr/page/updatePageInfo"),""!=e.postObj.url.trim()&&e.postObj.url!==e.originUrl&&""!=e.postObj.content.trim()?e.$confirm("修改外部URL后将清空自定义内容并保存，确定继续操作？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.postObj.content="",e.saveSubmit(i)}).catch(function(){e.$message({type:"info",message:"已取消"})}):e.saveSubmit(i)})},getPageType:function(){var e=this;this.$http.post("/cloud/backmgr/page/open/getPageTypeList").then(function(t){e.pageTypeList=t.result.list})},getContent:function(e){var t=this;this.$http.post("/cloud/backmgr/page/open/getPageInfo",{id:e}).then(function(e){t.postObj.content=e.result.appPageInfo.content||""})},saveSubmit:function(e){var t=this;this.$http.post(e,this.postObj).then(function(e){200==e.code&&t.$notify({title:"成功",message:e.msg,type:"success"}),t.$router.go(-1)})},beforeUpload:function(e){if(e.size>1048576)return this.$notify({title:"提示",message:"图片大小不得超过1M",type:"warning"}),!1},upScuccess:function(e,t,i){this.fullscreenLoading=!1;var l=this,s="";if("image"===this.uploadType?s=t.response.result.urls[0]:this.uploadType,null!=s&&s.length>0){var o=s;l.addRange=l.$refs.myQuillEditor.quill.getSelection(),l.$refs.myQuillEditor.quill.insertEmbed(null!==l.addRange?l.addRange.index:0,l.uploadType,o,a.a.sources.USER)}else this.$message.error(l.uploadType+"插入失败");this.$refs.upload.clearFiles()},imgHandler:function(e){(this.addRange=this.$refs.myQuillEditor.quill.getSelection(),e)&&document.getElementById("imgInput").click();this.uploadType="image"},videoHandler:function(e){(this.addRange=this.$refs.myQuillEditor.quill.getSelection(),e)&&document.getElementById("imgInput").click();this.uploadType="video"}},computed:{editor:function(){return this.$refs.myQuillEditor.quill}},mounted:function(){this.serverPath=window.SERVER_PATH,this.$refs.myQuillEditor.quill.getModule("toolbar").addHandler("image",this.imgHandler),this.$refs.myQuillEditor.quill.getModule("toolbar").addHandler("video",this.videoHandler)},activated:function(){if(this.getPageType(),this.$route.params&&this.$route.params.data){var e=this.$route.params.data,t={url:e.url,title:e.title,content:e.content,pageType:e.page_type,id:e.id};this.postObj=t,this.originUrl=e.url,"view"==this.$route.params.type?this.disabled=!0:this.disabled=!1,this.getContent(e.id)}else this.postObj={url:"",title:"",content:"",pageType:1},this.disabled=!1,this.originUrl=""},components:{quillEditor:l.quillEditor}},n={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"add-news-page"},[i("el-row",{staticStyle:{"margin-bottom":"20px"}},[i("el-col",{attrs:{span:20}},[i("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:function(t){e.$router.go(-1)}}},[e._v("返回")])],1),e._v(" "),e.disabled?e._e():i("el-col",{staticStyle:{"text-align":"right"},attrs:{span:4}},[i("el-button",{attrs:{size:"small",type:"primary"},nativeOn:{click:function(t){return e.save(t)}}},[e._v("保存")])],1)],1),e._v(" "),i("el-form",{ref:"form",attrs:{inline:!0,"label-width":"100px",rules:e.rules,model:e.postObj}},[i("el-form-item",{attrs:{label:"外部URL",prop:"realName"}},[i("el-input",{attrs:{size:"small",placeholder:"请输入外部URL",disabled:e.disabled},model:{value:e.postObj.url,callback:function(t){e.$set(e.postObj,"url","string"==typeof t?t.trim():t)},expression:"postObj.url"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"预发布类型",prop:"pageType"}},[i("el-select",{ref:"pageType",attrs:{size:"small",disabled:e.disabled},model:{value:e.postObj.pageType,callback:function(t){e.$set(e.postObj,"pageType",t)},expression:"postObj.pageType"}},e._l(e.pageTypeList,function(e,t){return i("el-option",{key:t,attrs:{label:e.typeName,value:e.pageType}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"标题",prop:"title"}},[i("el-input",{attrs:{size:"small",placeholder:"请输入标题",disabled:e.disabled},model:{value:e.postObj.title,callback:function(t){e.$set(e.postObj,"title","string"==typeof t?t.trim():t)},expression:"postObj.title"}})],1)],1),e._v(" "),i("quill-editor",{ref:"myQuillEditor",attrs:{disabled:e.disabled},model:{value:e.postObj.content,callback:function(t){e.$set(e.postObj,"content","string"==typeof t?t.trim():t)},expression:"postObj.content"}}),e._v(" "),i("el-upload",{ref:"upload",staticClass:"upload",staticStyle:{display:"none"},attrs:{action:e.serverPath+"wallet/util/open/uploadFile.do",name:"files",data:{type:"html"},"on-success":e.upScuccess,"before-upload":e.beforeUpload}},[i("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{size:"small",type:"primary",id:"imgInput","element-loading-text":"插入中,请稍候"}},[e._v("点击上传")])],1)],1)},staticRenderFns:[]};var r=i("C7Lr")(o,n,!1,function(e){i("5ZSI")},null,null);t.default=r.exports},"5ZSI":function(e,t){}});